# Operabase Hooks

These hook scripts integrate Operabase quality gates with Claude Code's hook system. They are automatically generated by `npx operabase init` and placed in your project's `.claude/hooks/` directory.

## What These Hooks Do

| Hook | Trigger | Purpose |
|------|---------|---------|
| `pre-commit.sh` | Before every `git commit` | Runs `pre_commit` quality gates (lint, typecheck, tests) |
| `pre-push.sh` | Before every `git push` | Runs `pre_push` quality gates (build) |

When a gate fails, the hook blocks the git operation and prints instructions for diagnosing the issue.

## How They Integrate with Claude Code

Claude Code supports user-defined hooks in `.claude/hooks/`. These scripts run automatically during git operations, enforcing quality gates **without requiring agents to remember to call them**. This means:

- `@dev` does not need to manually run lint/test before committing -- the hook handles it.
- `@devops` does not need to manually verify build before pushing -- the hook handles it.
- All agents benefit from invisible enforcement. No prompt-level discipline required.

## Customizing Gate Commands

The gate commands executed by these hooks are defined in your project's `operabase.yaml`:

```yaml
# operabase.yaml
gates:
  pre_commit:
    - "npm run lint"
    - "npm run typecheck"
    - "npm test"
  pre_push:
    - "npm run build"
```

To customize:
1. Edit the `gates` section in `operabase.yaml`
2. Add, remove, or reorder commands as needed
3. The hooks will pick up changes automatically (they call `npx operabase gates` which reads the config at runtime)

### Squad-Level Overrides

Squads can define their own quality gates in `squads/{squad}/config/quality-gates.yaml`. These extend or override the global gates. For example, a media-buying squad with no source code might disable lint/test entirely:

```yaml
# squads/media-buying/config/quality-gates.yaml
override:
  pre_commit: null  # No code to lint
```

## Important Notes

- These hooks are **auto-generated** by `npx operabase init`. Manual edits will be overwritten on upgrade.
- To add custom logic, define additional gate commands in `operabase.yaml` rather than editing the shell scripts directly.
- The hooks require `operabase` to be installed (`npx operabase` must resolve).
- Exit codes propagate: if any gate command fails, the entire hook fails and the git operation is blocked.
